{% extends "base.html" %}

{% block title %}Recommended Tools & Resources - TGFX Trade Lab{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="text-center mb-5">
            <h1 class="text-gradient-primary mb-3">
                <span class="material-symbols-outlined me-2" style="font-size: 2.5rem;">recommend</span>
                Recommended Tools & Resources
            </h1>
            <p class="text-muted mb-0 lead">Professional trading tools and resources we personally use and recommend</p>
        </div>
    </div>
</div>

<!-- Filter Categories -->
{% if categories %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex flex-wrap justify-content-center gap-2">
                    <a href="{{ url_for('recommendations') }}" 
                       class="badge text-decoration-none px-3 py-2 {% if not selected_category %}bg-primary{% else %}bg-secondary{% endif %}" 
                       style="font-size: 0.9rem;">
                        All Categories
                    </a>
                    {% for category in categories %}
                    <a href="?category={{ category }}" 
                       class="badge text-decoration-none px-3 py-2 {% if selected_category == category %}bg-primary{% else %}bg-secondary{% endif %}"
                       style="font-size: 0.9rem;">
                        {{ category|title }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Recommendations Grid -->
<div class="row g-4">
    {% for recommendation in recommendations %}
    <div class="col-lg-4 col-md-6">
        <div class="card recommendation-card h-100">
            <!-- Image Container -->
            <div class="position-relative overflow-hidden" style="height: 250px;">
                {% if recommendation.image_url %}
                <img src="{{ recommendation.image_url }}" class="card-img-top" alt="{{ recommendation.title }}" 
                     style="width: 100%; height: 100%; object-fit: cover;">
                {% else %}
                <div class="d-flex align-items-center justify-content-center h-100 bg-gradient-primary">
                    <span class="material-symbols-outlined text-white" style="font-size: 4rem;">
                        {% if recommendation.category == 'broker' %}
                        account_balance
                        {% elif recommendation.category == 'software' %}
                        computer
                        {% elif recommendation.category == 'education' %}
                        school
                        {% elif recommendation.category == 'tools' %}
                        build
                        {% else %}
                        recommend
                        {% endif %}
                    </span>
                </div>
                {% endif %}
                
                <!-- Category Badge -->
                <div class="position-absolute top-0 start-0 m-3">
                    <span class="badge bg-dark bg-opacity-75 text-white">
                        {{ recommendation.category|title }}
                    </span>
                </div>
                
                <!-- Featured Badge -->
                {% if recommendation.is_featured %}
                <div class="position-absolute top-0 end-0 m-3">
                    <span class="badge bg-warning text-dark">
                        <span class="material-symbols-outlined me-1" style="font-size: 14px;">star</span>
                        Featured
                    </span>
                </div>
                {% endif %}
                
                <!-- Discount Badge -->
                {% if recommendation.discount_percentage %}
                <div class="position-absolute bottom-0 end-0 m-3">
                    <span class="badge bg-danger">
                        {{ recommendation.discount_percentage }}% OFF
                    </span>
                </div>
                {% endif %}
            </div>
            
            <div class="card-body d-flex flex-column">
                <!-- Title -->
                <h5 class="card-title text-gradient-primary mb-3">{{ recommendation.title }}</h5>
                
                <!-- Description -->
                <p class="card-text text-muted mb-4 flex-grow-1">{{ recommendation.description }}</p>
                
                <!-- Features -->
                {% if recommendation.features %}
                <div class="mb-4">
                    <h6 class="text-white mb-2">Key Features:</h6>
                    <ul class="list-unstyled">
                        {% for feature in recommendation.features.split(',')[:3] %}
                        <li class="mb-1">
                            <span class="material-symbols-outlined text-success me-2" style="font-size: 16px;">check_circle</span>
                            <small class="text-muted">{{ feature.strip() }}</small>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                <!-- Pricing Info -->
                {% if recommendation.price_info %}
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted">Price:</span>
                        <span class="text-white fw-medium">{{ recommendation.price_info }}</span>
                    </div>
                </div>
                {% endif %}
                
                <!-- Coupon Code -->
                {% if recommendation.coupon_code %}
                <div class="mb-3">
                    <div class="alert alert-info py-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-white">
                                <span class="material-symbols-outlined me-1" style="font-size: 16px;">local_offer</span>
                                Use code: <strong>{{ recommendation.coupon_code }}</strong>
                            </small>
                            <button class="btn btn-sm btn-outline-primary" onclick="copyCode('{{ recommendation.coupon_code }}')">
                                Copy
                            </button>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Action Buttons -->
                <div class="mt-auto">
                    <div class="d-grid gap-2">
                        <a href="{{ recommendation.affiliate_url }}" 
                           target="_blank" 
                           rel="noopener nofollow"
                           class="btn btn-primary"
                           onclick="trackClick({{ recommendation.id }})">
                            <span class="material-symbols-outlined me-2">open_in_new</span>
                            Learn More & Get Started
                        </a>
                        {% if recommendation.demo_url %}
                        <a href="{{ recommendation.demo_url }}" 
                           target="_blank" 
                           rel="noopener"
                           class="btn btn-outline-secondary btn-sm">
                            <span class="material-symbols-outlined me-2">play_arrow</span>
                            View Demo
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    
    {% if not recommendations %}
    <div class="col-12">
        <div class="text-center py-5">
            <span class="material-symbols-outlined text-muted mb-3" style="font-size: 4rem;">search_off</span>
            <h4 class="text-gradient-primary mb-3">No Recommendations Found</h4>
            {% if selected_category %}
            <p class="text-muted mb-4">No recommendations found in the "{{ selected_category|title }}" category</p>
            <a href="{{ url_for('recommendations') }}" class="btn btn-primary">
                <span class="material-symbols-outlined me-2">refresh</span>
                View All Recommendations
            </a>
            {% else %}
            <p class="text-muted mb-4">No recommendations available yet. Check back soon!</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Disclaimer -->
{% if recommendations %}
<div class="row mt-5">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <span class="material-symbols-outlined text-warning me-3 mt-1">info</span>
                    <div>
                        <h6 class="text-white mb-2">Affiliate Disclosure</h6>
                        <p class="text-muted small mb-0">
                            Some of the links on this page are affiliate links, which means we may earn a commission 
                            if you make a purchase through these links. This comes at no additional cost to you and 
                            helps support our platform. We only recommend tools and services that we personally use 
                            and believe will add value to your trading journey.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Success Toast -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="copyToast" class="toast" role="alert">
        <div class="toast-header bg-success text-white">
            <span class="material-symbols-outlined me-2">check_circle</span>
            <strong class="me-auto">Success!</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body bg-dark text-white">
            Coupon code copied to clipboard!
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth animations
    const cards = document.querySelectorAll('.recommendation-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});

function copyCode(code) {
    navigator.clipboard.writeText(code).then(function() {
        // Show success toast
        const toast = new bootstrap.Toast(document.getElementById('copyToast'));
        toast.show();
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
        showToast('Failed to copy code', 'error');
    });
}

function trackClick(recommendationId) {
    // Track recommendation click for analytics
    fetch('/api/recommendations/track-click', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            recommendation_id: recommendationId
        })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Click tracked:', data);
    })
    .catch(error => {
        console.error('Error tracking click:', error);
    });
}
</script>

<style>
.recommendation-card {
    transition: all 0.3s ease;
    border: 1px solid var(--border-color);
    cursor: pointer;
    overflow: hidden;
}

.recommendation-card:hover {
    transform: translateY(-8px);
    border-color: var(--primary-color);
    box-shadow: 0 15px 35px rgba(16, 185, 129, 0.2);
}

.recommendation-card .card-img-top {
    transition: transform 0.3s ease;
}

.recommendation-card:hover .card-img-top {
    transform: scale(1.05);
}

.badge {
    font-weight: 600;
}

.alert-info {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.2);
}

/* Toast styling */
.toast {
    backdrop-filter: blur(10px);
}
</style>
{% endblock %}
